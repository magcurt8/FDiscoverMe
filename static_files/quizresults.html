<html>
	<title>DiscoverMe</title>
	<head>
		<link 
		<link rel="stylesheet" media="screen" href="style.css" />
		<style type="text/css">
		body{
			background-color: #006699;
			font-family: sans-serif;
			color: #FFFFFF;
		}
			h2{
				font-size:20%;
				text-align:center;
				color: #336699;
			}
			a{
				font-size:18px;
				color:white;
				font-style: italic;
				text-shadow: 1px 1px 0px #bfbfbf;
			}
			a:hover{
				font-size:18px;
				color:blue;
				font-style: normal;
				text-shadow: 1px 1px 0px white;
			}
			.myButtons{
				color: black;
				background-color: #b3ffff;
    			width: 28em;
    			height: 5em;
    			border-radius: 10px;
			}
			.myButtons:hover{
				background-color: #000066;
				color: white;
				font-style: italic;
			}
			#message{
				font-size: 30px;
				font-family: Impact, Haettenschweiler, 'Franklin Gothic Bold', Charcoal, 'Helvetica Inserat', 'Bitstream Vera Sans Bold', 'Arial Black', 'sans serif';
				font-weight:bold;
				color: #cc0000;
			}
			#search{
				font-size: 20px;
				font-weight:bold;
				text-align:center;
				color: white;
			}
			#popup, .bMulti {
				text-size: 10px;
    			background-color: #FFF;
    			border-radius: 20px 20px 20px 20px;
    			box-shadow: 0 0 5px 5px #ffffff;
    			color: #111;
    			display: none;
    			min-width: 400px;
    			min-height: 375px;
    			padding: 25px;
			}
			#popup .logo {
				text-size: 10px;
   				color: #2B91AF;
    			font: bold 325% 'Petrona',sans;
    			text-align: center;
    			align:center;
			}
			.button.b-close, .button.bClose {
				text-size: 10px;
    			border-radius: 7px 7px 7px 7px;
    			box-shadow: none;
    			font: bold 131% sans-serif;
    			padding: 0 6px 2px;
    			position: absolute;
    			right: -7px;
    			top: -7px;
			}
			.button {
    			background-color: #2B91AF;
    			border-radius: 10px;
    			box-shadow: 0 2px 3px rgba(0, 0, 0, 0.3);
    			color: #FFF;
    			cursor: pointer;
    			display: inline-block;
    			padding: 10px 20px;
    			text-decoration: none;
			}
			.theButton{
				background-color: #ff6600;
    			border-radius: 10px;
    			box-shadow: 0 2px 3px rgba(0, 0, 0, 0.3);
    			color: #FFF;
    			cursor: pointer;
    			display: inline-block;
    			padding: 10px 20px;
    			color:black;
    			font-style: italic;
    			font-weight:bold;
    			text-decoration: none;
			}
			.TheBUTTON{
				background-color: #ff6600;
    			border-radius: 10px;
    			box-shadow: 0 2px 3px rgba(0, 0, 0, 0.3);
    			color: #FFF;
    			cursor: pointer;
    			display: inline-block;
    			padding: 10px 20px;
    			color:black;
    			font-style: italic;
    			font-weight:bold;
    			text-decoration: none;
			}
			#field{
				text-align:center;
				font-family:sans-serif;
				font-size:20px;
				font-weight:bold;
			}
			#searchButton {
				position:absolute;
				bottom:100px;
				right:0px;
				font-size: 20px;
				/*!!!!MAY HAVE TO CHANGE COLOR TO WHITE AGAIN WITH BACKGROUND!!*/
				color: black;
            	background-color: Transparent;
            	background-repeat:no-repeat;
            	border: none;
            	cursor:pointer;
            	overflow: hidden;
        	}
        	#searchButton:hover{
				font-style:italic;
				color:gray;
			}
        	.modal-body {
    			min-height: 350px;
    			-webkit-overflow-scrolling: touch;
    			overflow: visible;
			}
			.fixed-dialog{
				font-size:10px;
  				position: fixed;
  				top: 50px;
  				left: 50px;
			}
			.ui-widget {
    			font-family: helvetica, sans-serif;
    			font-size: .8em;
    			opacity:1.0;
			}
			.ui-widget-content {
    			background: rgba(0,0,0,0);
    			color: #222222;
			}
			.ui-dialog {
    			left: 0;
    			outline: 0 none;
    			padding: 0 !important;
    			position: relative;
    			top: 0;
			}
			.ui-dialog .ui-dialog-content {
				background-color: #FFF;
    			border-radius: 10px 10px 10px 10px;
    			background: none repeat scroll 0 0 transparent;
   				border: 0 none;
    			overflow: auto;
   				position: relative;
    			padding: 25px;
    			box-shadow: 0 0 15px 15px #ffffff;
			}
			.ui-dialog-titlebar-close {
  				background-color: #2B91AF;
    			border-radius: 10px;
    			box-shadow: 0 2px 3px rgba(225, 225, 225, 0.3);
    			color: #FFF;
    			cursor: pointer;
    			display: inline-block;
    			padding: 5px 10px;
    			color:white;
    			font-weight:bold;
    			text-decoration: none;
			}
			.ui-dialog-titlebar-close:hover{
				background-color: #ff6600;
				font-style: italic;
			}
			.ui-widget-overlay {
   				background-color: white;
			}
			.mainpage{
				font-size:80px;
			}
			#message{
				color: white;
				text-align:center;
				font-weight:normal;
			}
		</style>
		<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
		<script src="http://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>
		<script type="text/javascript">
		function goToErrorPage(){
			window.location='http://localhost:3000/error.html';
		}
	
		$(document).ready(function(){

			$('#logout').click(function(){
				localStorage.clear();
				window.location = 'http://localhost:3000/test.html';
			});

			if(localStorage.getItem('results') &&localStorage.getItem('locationResults')){
				$('#qresults').append( localStorage.getItem('results')+ "," + localStorage.getItem('locationResults'));
				$.ajax({
						url: "search/country/" + localStorage.getItem('locationResults'),
						type: "GET",
						dataType: "json",
						success: function(data){
							if(data.status  == 'NoResults'){
								$('#message').empty();
								$('#message').text("There are no places or events to display at this time.");
							} else if(data.status){
								goToErrorPage();
							} else {
								$('#message').empty();
								createElements(data);
								$('#popup').dialog('close');
							}
						},
						error: function(){
							goToErrorPage();
						}
					});
			} 
			function createElements(data){
				var theString = data.length;
				console.log(theString);
				if(data.length == 0){
					$('#message').html("There are no search results found");
				} else {
					//document.getElementById('theElements').appendChild(document.createElement("BR"));
					//document.getElementById('theElements').appendChild(document.createElement("BR"));
					var buttons = [];
					var places = JSON.parse(localStorage.getItem('places'));
					var completed = JSON.parse(localStorage.getItem('completed'));
					for(var i = 0; i < data.length; i++){
						var theLoc = data[i];
						buttons[i] = document.createElement("BUTTON");
						var name = document.createTextNode(data[i].name);
						var lineBreak1 = document.createElement("BR");
						var lineBreak2 = document.createElement("BR");
						var city = document.createTextNode(data[i].city);
						var state = document.createTextNode(data[i].state);
						var country = document.createTextNode(data[i].country);
						var comma1 = document.createTextNode(", ");
						var comma2 = document.createTextNode(", ");
						var type = document.createTextNode(data[i].type);
						if(localStorage.getItem('places') && localStorage.getItem('places') !== '[]'){
							for(var j = 0; j < places.length; j++){
								if(places[j].name == data[i].name && places[j].city === data[i].city && places[j].state === data[i].state && places[j].country == data[i].country){
									buttons[i].setAttribute("disabled","disabled");
									buttons[i].style.backgroundColor = "#ffffff";
									break;
								}
							}
						}
						
						if(localStorage.getItem('completed') && localStorage.getItem('completed') != '[]'){
							for(var k = 0; k < completed.length; k++){
								if(completed[k].name === data[i].name && completed[k].city === data[i].city && completed[k].state === data[i].state && completed[k].country == data[i].country){
									buttons[i].setAttribute("disabled","disabled");
									buttons[i].style.backgroundColor = "#ffffff";
									break;
								}
							}
						}
						buttons[i].setAttribute("id", JSON.stringify(data[i]));
						buttons[i].setAttribute("class", "myButtons");
						buttons[i].setAttribute("width", "400px");
						console.log(buttons[i].getAttribute('id'));
						buttons[i].style.textAlign = 'left';
						buttons[i].style.fontSize = '15px';
						buttons[i].appendChild(name);
						buttons[i].appendChild(lineBreak1);
						buttons[i].appendChild(city);
						buttons[i].appendChild(comma1);
						buttons[i].appendChild(state);
						buttons[i].appendChild(comma2);
						buttons[i].appendChild(country);
						buttons[i].appendChild(lineBreak2);
						buttons[i].appendChild(type);
						buttons[i].addEventListener('click', myFunction);					
						document.getElementById('theElements').appendChild(buttons[i]);
					}
				}
			}
			function myFunction(){
				var id = this.id;
				var info = JSON.parse(this.id);
				$.ajax({
					url: "places/" + localStorage.getItem('username') + "/" + localStorage.getItem('password'),
					type: "POST",
					dataType: "json",
					data: { name: info.name,
							type: info.type,
							city: info.city,
							state: info.state,
							country: info.country},
					success: function(data){
						console.log(data);
						if(data.username){
							//add places to the local storage
							localStorage['places'] = data.places;
							//disable the button and change the color to a light green
							document.getElementById(id).setAttribute("disabled","disabled");
							document.getElementById(id).style.backgroundColor = "#99ff99";
							//create a popup that lasts 2 seconds to tell the user that the item was added to their list
							$('#popup').empty();
							$('#popup').dialog({
								width: 300,
								height: 250,
  								autoOpen: true,
  								dialogClass: "fixed-dialog",
  								show: {
    								effect: "drop",
    								duration: 1000
  								},
  								hide: {
    								effect: "explode",
    								duration: 200
  								}
							}); 
							var html = $("#popup").html();
                			$("#popup").html(html + "<br>Successfully added:<br><br>" + info.name + "<br>" + info.city + ", " + info.state + ", " + info.country + "<br>" + info.type + "<br><br> to your bucket list");
                			setTimeout(destroyDialog, 3000);
						} else {
							$('#popup').empty();
							$('#popup').dialog({
								width: 300,
								height: 250,
  								autoOpen: true,
  								show: {
    								effect: "drop",
    								duration: 1000
  								},
  								hide: {
    								effect: "explode",
    								duration: 200
  								}
							}); 
							var html = $("#popup").html();
                			$("#popup").html(html + "<br>Could not add<br>" + info.name + "<br>" + info.city + ", " + info.state + ", " + info.country + "<br>" + info.type + "<br><br> to your bucket list");
                			setTimeout(destroyDialog, 3000);
						}
					}
				});				
			}
			function destroyDialog(){
				$("#popup").dialog('close');
			}
		});
	</script>

	</head>
	<body>
			<h1 class="header" height="50px">DiscoverMe
			<button style="float: right"id="logout">Logout</button>
				<ul class="nav">
 					<li><a href="login.html">Home</a></li>
 					<li><a href="quiz.html" class="is-active">Quiz</a></li>
 					<li><a href="bucketList.html">Bucket List: Current</a></li>
 					<li><a href="completed.html">Bucket List: Completed</a></li>
 					<li><a href="createEvent.html">Create Event</a></li>
 					<li><a href="search.html">Search</a></li>
 					<li><a href="settings.html">Settings</a></li>
				</ul>
			</h1>
			<div class="mainpage">
				<p align="center" id="qresults">You should visit: </p>
				<p id="message"></p>
				<h2><div id="theElements"></div>
			</div>
			<div id="popup"></div></h2>
	</body>
</html>
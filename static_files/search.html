<!-- HTML search page
	source: http://www.cssfontstack.com/Impact
	source: http://stackoverflow.com/questions/14879168/document-onclick-id-function-vs-id-onclick-function
	source: http://stackoverflow.com/questions/7368524/how-to-close-a-jquery-ui-modal-dialog-by-clicking-outside-the-area-covered-by-th
	source: http://stackoverflow.com/questions/4263358/set-the-dialog-modal-width-for-jquery-ui
	source: http://stackoverflow.com/questions/14228772/bootstrap-2-set-dialog-modal-position
	source: http://api.jqueryui.com/dialog/
	source: http://stackoverflow.com/questions/21604674/bootstrap-modal-background-jumps-to-top-on-toggle
	source: http://stackoverflow.com/questions/7584362/jquery-ui-modal-dialog-should-be-fixed-on-scroll
	source: http://stackoverflow.com/questions/17386839/custom-style-to-jquery-ui-dialogs
	source: https://github.com/dinbror/bpopup
-->

<html>
	<head>
		<title>DiscoverMe | Home</title>
		<link rel="stylesheet" media="screen" href="style.css" />
		<style type="text/css">
			h1{
				text-align:center;
				font-size: 70px;
				font-family: helvetica, sans-serif;
				font-weight:bold;
				color: white;
			}
			h2{
				text-align:center;
				color: #336699;
			}
			body{
				background-color:transparent;
				background: url(world.jpg) no-repeat;
				-webkit-background-size: cover;
				-moz-background-size: cover;
				-o-background-size: cover;
				background-size: cover; 
			}
			a{
				font-size:18px;
				color:white;
				font-style: italic;
				text-shadow: 1px 1px 0px #bfbfbf;
			}
			a:hover{
				font-size:18px;
				color:blue;
				font-style: normal;
				text-shadow: 1px 1px 0px white;
			}
			.myButtons{
				color: black;
				background-color: #b3ffff;
    			width: 28em;
    			height: 5em;
    			border-radius: 10px;
			}
			.myButtons:hover{
				background-color: #000066;
				color: white;
				font-style: italic;
			}
			#message{
				font-size: 30px;
				font-family: helvetica, sans-serif;
				font-weight:bold;
				color: #cc0000;
			}
			#search{
				font-size: 20px;
				font-weight:bold;
				text-align:center;
				color: white;
			}
			#popup, .bMulti {
    			background-color: #FFF;
    			border-radius: 20px 20px 20px 20px;
    			box-shadow: 0 0 5px 5px #ffffff;
    			color: #111;
    			display: none;
    			min-width: 400px;
    			min-height: 375px;
    			padding: 25px;
			}
			#popup .logo {
   				color: #2B91AF;
    			font: bold 325% 'Petrona',sans;
    			text-align: center;
    			align:center;
			}
			.button.b-close, .button.bClose {
    			border-radius: 7px 7px 7px 7px;
    			box-shadow: none;
    			font: bold 131% sans-serif;
    			padding: 0 6px 2px;
    			position: absolute;
    			right: -7px;
    			top: -7px;
			}
			.button {
    			background-color: #2B91AF;
    			border-radius: 10px;
    			box-shadow: 0 2px 3px rgba(0, 0, 0, 0.3);
    			color: #FFF;
    			cursor: pointer;
    			display: inline-block;
    			padding: 10px 20px;
    			text-decoration: none;
			}
			.theButton{
				background-color: #ff6600;
    			border-radius: 10px;
    			box-shadow: 0 2px 3px rgba(0, 0, 0, 0.3);
    			color: #FFF;
    			cursor: pointer;
    			display: inline-block;
    			padding: 10px 20px;
    			color:black;
    			font-style: italic;
    			font-weight:bold;
    			text-decoration: none;
			}
			.TheBUTTON{
				background-color: #ff6600;
    			border-radius: 10px;
    			box-shadow: 0 2px 3px rgba(0, 0, 0, 0.3);
    			color: #FFF;
    			cursor: pointer;
    			display: inline-block;
    			padding: 10px 20px;
    			color:black;
    			font-style: italic;
    			font-weight:bold;
    			text-decoration: none;
			}
			#field{
				text-align:center;
				font-family:sans-serif;
				font-size:20px;
				font-weight:bold;
			}
			#searchButton {
				position: absolute;
				font-size: 50px;
				color: white;
            	background-color: Transparent;
            	border:none;
            	cursor:pointer;
            	overflow:hidden;
        	}
        	#searchButton:hover{
				color:gray;
				font-style:italic;
			}
        	.modal-body {
    			min-height: 350px;
    			-webkit-overflow-scrolling: touch;
    			overflow: visible;
			}
			.fixed-dialog{
  				position: fixed;
  				top: 50px;
  				left: 50px;
			}
			.ui-widget {
    			font-family: helvetica,sans-serif;
    			font-size: .8em;
    			opacity:1.0;
			}

			.ui-widget-content {
    			background: rgba(0,0,0,0);
    			color: #222222;
			}

			.ui-dialog {
    			left: 0;
    			outline: 0 none;
    			padding: 0 !important;
    			position: relative;
    			top: 0;

			}
			.ui-dialog .ui-dialog-content {
				background-color: #FFF;
    			border-radius: 10px 10px 10px 10px;
    			background: none repeat scroll 0 0 transparent;
   				border: 0 none;
    			overflow: auto;
   				position: relative;
    			padding: 25px;
    			box-shadow: 0 0 15px 15px #ffffff;
			}
			.ui-dialog-titlebar-close {
  				background-color: #2B91AF;
    			border-radius: 10px;
    			box-shadow: 0 2px 3px rgba(225, 225, 225, 0.3);
    			color: #FFF;
    			cursor: pointer;
    			display: inline-block;
    			padding: 5px 10px;
    			color:white;
    			font-weight:bold;
    			text-decoration: none;
			}
			.ui-dialog-titlebar-close:hover{
				background-color: #ff6600;
				font-style: italic;
			}
			.ui-widget-overlay {
   				background-color: white;
			}

			
		</style>

		<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
		<script src="http://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>
		<script type="text/javascript">

		function goToErrorPage(){
			window.location = 'http://localhost:3000/error.html';
		}

		function goToSearchResults(){
			window.location = 'http://localhost:3000/searchResults.html';
		}


		$(document).ready(function(){

			$('#logout').click(function(){
				localStorage.clear();
				window.location = 'http://localhost:3000/test.html';
			});


			$('#popup').empty();
			$('#popup').dialog({
				width: 400,
				height: 375,
				modal: true,
  				autoOpen: true,
  				dialogClass: "fixed-dialog",
  				show: {
    				effect: "drop",
    				duration: 1000
  				},
  				hide: {
    				effect: "explode",
    				duration: 200
  				},	
  				open: function (event, ui) {
        			$('.ui-widget-overlay').addClass('override');
    }
			});

			var html = $("#popup").html();
			$("#popup").html(html + "<button id='Place' class='TheBUTTON'>Place</button><button id='Type' class='button'>Type</button><button id='City' class='button'>City</button><button id='State' class='button'>State</button><button id='Country' class='button'>Country</button><br><br><br><p id='field'>Search by Name</p><p align='center'>Name:<input id='name' type='text' size = '20'/></p><p align='center'><button id='nameSearch' class='theButton'>Search by Name</button></p>"); 

			$(document).on('click', '.button', function(e){
				console.log(e);
				console.log(e.currentTarget.id);
				
            if(e.currentTarget.id == 'Place'){
				$("#popup").empty();
            	$("#popup").html(html + "<button id='Place' class='TheBUTTON'>Place</button><button id='Type' class='button'>Type</button><button id='City' class='button'>City</button><button id='State' class='button'>State</button><button id='Country' class='button'>Country</button><br><br><br><p id='field'>Search by Name</p><p align='center'>Name:<input id='name' type='text' size = '20'/></p><br><p align='center'><button id='nameSearch' class='theButton'>Search by Name</button></p>");
            }
            	

            if(e.currentTarget.id == 'Type'){
				$("Epopup").empty();
            	$("#popup").html(html + "<button id='Place' class='button'>Place</button><button id='Type' class='TheBUTTON'>Type</button><button id='City' class='button'>City</button><button id='State' class='button'>State</button><button id='Country' class='button'>Country</button><br><br><br><p id='field'>Search by Type</p><p align='center'>Type: <select id='type'></p><option></option><option>Arts and Entertainment</option><option>Amusement Park</option><option>College or University</option><option>Food and Drink</option><option>Historical Site</option><option>Landmark</option><option>Monument</option><option>Relaxation Spot</option><option>Sports</option><option>Other</option></select><br><p id='field'><button id='typeSearch' class='theButton'>Search by Type</button></p>");
			}

            if(e.currentTarget.id == 'City'){
            	$("#popup").empty();
            	$("#popup").html(html + "<button id='Place' class='button'>Place</button><button id='Type' class='button'>Type</button><button id='City' class='TheBUTTON'>City</button><button id='State' class='button'>State</button><button id='Country' class='button'>Country</button><br><br><br><p id='field'>Search by City</p><p align='center'>City: <input id='cityCity' type='text' size='20'/></p><p align='center'>State/Territory: <input id='cityState' type='text' size='20'></p><p align='center'>Country:<select id='cityCountry'></p><option id=''></option><option id='US'>United States</option><option id='AU'>Australia</option><option id='UK'>United Kingdom</option></select><br><p align='center'><button class ='theButton' id='citySearch'>Search by City</button></p>");
            }

            if(e.currentTarget.id == 'State'){
            	$('#popup').empty();
            	$('#popup').html(html + "<button id='Place' class='button'>Place</button><button id='Type' class='button'>Type</button><button id='City' class='button'>City</button><button id='State' class='TheBUTTON'>State</button><button id='Country' class='button'>Country</button><br><br><br><p id='field'>Search by State</p><p align='center'>State/Territory: <input id='stateState' type='text' size='20'/></p><p align='center'>Country:<select id='stateCountry'></p><option id=''></option><option id='US'>United States</option><option id='AU'>Australia</option><option id='UK'>United Kingdom</option></select><br><p align='center'><button id='stateSearch' class='theButton'>Search by State/Territory</button>");
            }

            if(e.currentTarget.id == 'Country'){
            	$('#popup').empty();
            	$('#popup').html(html + "<button id='Place' class='button'>Place</button><button id='Type' class='button'>Type</button><button id='City' class='button'>City</button><button id='State' class='button'>State</button><button id='Country' class='TheBUTTON'>Country</button><br><br><br><p id='field'>Search by Country:</p><p align='center'>Country:<select id='countryCountry'></p><option id=''></option><option id='US'>United States</option><option id='AU'>Australia</option><option id='UK'>United Kingdom</option></select><br><p align='center'><button id='countrySearch' class='theButton'>Search by Country</button>");
            }
				
			});
            
			$(document).on('click', '.theButton', function(e){

				$('#theElements').empty();

				if(e.currentTarget.id == 'nameSearch'){
            		$.ajax({
						url: "search/name/" + $('#name').val(),
						type: "GET",
						dataType: "json",
						success: function(data){
							if(data.status  == 'NoResults'){
								$('#message').empty();
								$('#message').text("You have no places or events to display at this time.");
							} else if(data.status){
								goToErrorPage();
							} else {
								$('#message').empty();
								createElements(data);
								$('#popup').dialog('close');
							}
						},
						error: function(){
							goToErrorPage();
						}
					});
            	}

            	if(e.currentTarget.id == 'typeSearch'){
            		$.ajax({
						url: "search/type/" + $('#type').val(),
						type: "GET",
						dataType: "json",
						success: function(data){
							if(data.status  == 'NoResults'){
								$('#message').empty();
								$('#message').text("You have no places or events to display at this time.");
							} else if(data.status){
								goToErrorPage();
							} else {
								$('#message').empty();
								createElements(data);
								$('#popup').dialog('close');
							}
						},
						error: function(){
							goToErrorPage();
						}
					});
            	}

            	if(e.currentTarget.id == 'citySearch'){
            		$.ajax({
						url: "search/city/" + $('#cityCity').val() + '/' + $('#cityState').val() + '/' + $('#cityCountry').val(),
						type: "GET",
						dataType: "json",
						success: function(data){
							if(data.status  == 'NoResults'){
								$('#message').empty();
								$('#message').text("You have no places or events to display at this time.");
							} else if(data.status){
								goToErrorPage();
							} else {
								$('#message').empty();
								createElements(data);
								$('#popup').dialog('close');
							}
						},
						error: function(){
							goToErrorPage();
						}
					});
            	}

            	if(e.currentTarget.id == 'stateSearch'){
            		$.ajax({
						url: "search/state/" + $('#stateState').val() + '/' + $('#stateCountry').val(),
						type: "GET",
						dataType: "json",
						success: function(data){
							if(data.status  == 'NoResults'){
								$('#message').empty();
								$('#message').text("You have no places or events to display at this time.");
							} else if(data.status){
								goToErrorPage();
							} else {
								$('#message').empty();
								createElements(data);
								$('#popup').dialog('close');
							}
						},
						error: function(){
							goToErrorPage();
						}
					});
            	}

            	if(e.currentTarget.id == 'countrySearch'){
            		$.ajax({
						url: "search/country/" + $('#countryCountry').val(),
						type: "GET",
						dataType: "json",
						success: function(data){
							if(data.status  == 'NoResults'){
								$('#message').empty();
								$('#message').text("You have no places or events to display at this time.");
							} else if(data.status){
								goToErrorPage();
							} else {
								$('#message').empty();
								createElements(data);
								$('#popup').dialog('close');
							}
						},
						error: function(){
							goToErrorPage();
						}
					});
            	}
			});

			$(document).on('click', '#searchButton', function(e){
				$('#popup').empty();
				$('#popup').dialog({
					width: 400,
					height: 375,
  					autoOpen: true,
  					show: {
    					effect: "drop",
    					duration: 1000
  					},
  					hide: {
  						effect: "explode",
  						duration: 200
  					}
				});

				var html = $("#popup").html();
				$("#popup").html(html + "<button id='Place' class='theButton'>Place</button><button id='Type' class='button'>Type</button><button id='City' class='button'>City</button><button id='State' class='button'>State</button><button id='Country' class='button'>Country</button><br><br><br><p id='field'>Search by Name</p><p align='center'>Name:<input id='name' type='text' size = '20'/></p><p align='center'><button id='nameSearch' class='theButton'>Search by Name</button></p>");

			});

			function createElements(data){
				var theString = data.length;
				console.log(theString);
				if(data.length == 0){
					$('#message').html("There are no search results found");
					$('#searchbutton').click($("#popup").html());
				} else {
					document.getElementById('theElements').appendChild(document.createElement("BR"));
					document.getElementById('theElements').appendChild(document.createElement("BR"));
					var buttons = [];
					var places = JSON.parse(localStorage.getItem('places'));
					var completed = JSON.parse(localStorage.getItem('completed'));
					for(var i = 0; i < data.length; i++){
						var theLoc = data[i];
						buttons[i] = document.createElement("BUTTON");
						var name = document.createTextNode(data[i].name);
						var lineBreak1 = document.createElement("BR");
						var lineBreak2 = document.createElement("BR");
						var city = document.createTextNode(data[i].city);
						var state = document.createTextNode(data[i].state);
						var country = document.createTextNode(data[i].country);
						var comma1 = document.createTextNode(", ");
						var comma2 = document.createTextNode(", ");
						var type = document.createTextNode(data[i].type);

						if(localStorage.getItem('places') !== '[]' && localStorage.getItem('places')){
							for(var j = 0; j < places.length; j++){
								if(places[j].name == data[i].name && places[j].city === data[i].city && places[j].state === data[i].state && places[j].country == data[i].country){
									buttons[i].setAttribute("disabled","disabled");
									buttons[i].style.backgroundColor = "#ffffff";
									break;
								}
							}
						}
						
						if(localStorage.getItem('completed') !== '[]' && localStorage.getItem('completed')){
							for(var k = 0; k < completed.length; k++){
								if(completed[k].name === data[i].name && completed[k].city === data[i].city && completed[k].state === data[i].state && completed[k].country == data[i].country){
									buttons[i].setAttribute("disabled","disabled");
									buttons[i].style.backgroundColor = "#ffffff";
									break;
								}
							}
						}

						buttons[i].setAttribute("id", JSON.stringify(data[i]));
						buttons[i].setAttribute("class", "myButtons");
						buttons[i].setAttribute("width", "400px");
						console.log(buttons[i].getAttribute('id'));
						buttons[i].style.textAlign = 'left';
						buttons[i].style.fontSize = '15px';
						buttons[i].appendChild(name);
						buttons[i].appendChild(lineBreak1);
						buttons[i].appendChild(city);
						buttons[i].appendChild(comma1);
						buttons[i].appendChild(state);
						buttons[i].appendChild(comma2);
						buttons[i].appendChild(country);
						buttons[i].appendChild(lineBreak2);
						buttons[i].appendChild(type);
						buttons[i].addEventListener('click', myFunction);					
						document.getElementById('theElements').appendChild(buttons[i]);
					}
				}
			}

			function myFunction(){

				var id = this.id;
				var info = JSON.parse(this.id);

				$.ajax({
					url: "places/" + localStorage.getItem('username') + "/" + localStorage.getItem('password'),
					type: "POST",
					dataType: "json",
					data: { name: info.name,
							type: info.type,
							city: info.city,
							state: info.state,
							country: info.country},
					success: function(data){
						console.log(data);
						if(data.username){
							//add places to the local storage
							localStorage['places'] = data.places;
							//disable the button and change the color to a light green
							document.getElementById(id).setAttribute("disabled","disabled");
							document.getElementById(id).style.backgroundColor = "#ffffff";
							//create a popup that lasts 2 seconds to tell the user that the item was added to their list
							$('#popup').empty();
							$('#popup').dialog({
								width: 300,
								height: 250,
  								autoOpen: true,
  								dialogClass: "fixed-dialog",
  								show: {
    								effect: "drop",
    								duration: 1000
  								},
  								hide: {
    								effect: "explode",
    								duration: 200
  								}
							}); 

							var html = $("#popup").html();
                			$("#popup").html(html + "<br>Successfully added:<br><br>" + info.name + "<br>" + info.city + ", " + info.state + ", " + info.country + "<br>" + info.type + "<br><br> to your bucket list");

                			setTimeout(destroyDialog, 3000);

						} else {

							$('#popup').empty();
							$('#popup').dialog({
								width: 300,
								height: 250,
  								autoOpen: true,
  								show: {
    								effect: "drop",
    								duration: 1000
  								},
  								hide: {
    								effect: "explode",
    								duration: 200
  								}
							}); 
							var html = $("#popup").html();
                			$("#popup").html(html + "<br>Could not add<br>" + info.name + "<br>" + info.city + ", " + info.state + ", " + info.country + "<br>" + info.type + "<br><br> to your bucket list");

                			setTimeout(destroyDialog, 3000);
						}
					}
				});				
			}

			function destroyDialog(){
				$("#popup").dialog('close');
			}
		});

		</script>

	</head>

	<body>
			<h1 class="header" height="20px">DiscoverMe
			<button style="float: right"id="logout">Logout</button>
				<ul class="nav">
 					<li><a href="login.html">Home</a></li>
 					<li><a href="quiz.html">Quiz</a></li>
 					<li><a href="bucketList.html">Bucket List: Current</a></li>
 					<li><a href="completed.html">Bucket List: Completed</a></li>
 					<li><a href="createEvent.html">Create Event</a></li>
 					<li><a href="search.html" class="is-active">Search</a></li>
 					<li><a href="settings.html">Settings</a></li>
				</ul>
			</h1>
		<div class="mainpage">
			<div style="position: absolute; top:450px; left:450px; width:800px; height:30px" id="message"></div>
			<h1><button id="searchButton">Search Again</button></h1>
			<div id="popup"></div>
			<h2><div id="theElements"></div></h2>
		</div>
	</body>
</html>
